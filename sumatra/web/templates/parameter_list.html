{% extends "base.html" %}

{% load filters %}

{% block title %}{{project.id}}: List of parameters{% endblock %}

{% block css %}
    <link href="/static/css/dataTables.bootstrap.css" rel="stylesheet">
    <link href="/static/css/extensions/dataTables.colReorder.min.css" rel="stylesheet">
{% endblock %}

{% block navbar %}
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    <span class="glyphicon glyphicon-file"></span>
                    <span id="main_file-label">{{selected_main_file|default:"Script file"}}</span>
                    <span class="caret"></span>
                </a>
                <ul class="dropdown-menu" role="menu" id="main_fileList">
                {% for main_file in project.get_main_files %}
                    <li>
                        <a href="/{{project}}/parameter/?main_file={{main_file}}">{{main_file}}</a>
                    </li>
                {% endfor %}
                </ul>
            </li>
{% endblock %}

{% block content %}

{% if project.name %}
<h3>{{project.name}}</h3>
{% endif %}

{% if selected_main_file %}
    <table id="records" class="table table-striped table-condensed" cellspacing="0" width="100%">
        <thead>
            <tr></tr>
        </thead>
        <tbody>
        </tbody>
        <tfoot>
            <tr></tr>
        </tfoot>
    </table>
{% else %}
    <p style="margin:10px"> Please first select a script file. </p>
{% endif %}

{% endblock %}

{% block scripts %}
<script type="text/javascript" language="javascript" src="/static/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" language="javascript" src="/static/js/dataTables.bootstrap.js"></script>
<script type="text/javascript" language="javascript" src="/static/js/extensions/dataTables.colReorder.min.js"></script>
<script type="text/javascript">
$('#nav-parameter').addClass('active');

{% if selected_main_file %}
    var selected_main_file = "{{selected_main_file|safe}}";
    var columns = {{columns|safe}};

$(document).ready(function() {

    for (var idx in columns) {
        $("#records thead tr").append("<th>"+columns[idx]+"</th>")
        // $("#records tfoot tr").append("<th>"+columns[idx]+"</th>")
    }

    // // Setup - add a text input to each footer cell
    // $('#records tfoot th').each( function () {
    //     var title = $('#records thead th').eq( $(this).index() ).text();
    //     $(this).html( '<input type="text" placeholder="Search '+title+'" />' );
    // } );

    var columnDefs = [
        {"render": function(data, type, row) {
            return '<a href="/'+row.project+'/'+data+'/">'+data+'</a>';
        }, "targets": [0]},                                                     // label
            {"render": function(data, type, row) {
            if (data.length < 5) {
                return data
            } else {
                return '<span title="'+data+'">'+data.slice(0,5)+'</span>'
            }
        }, "targets": [2]},                                                    // version
    ]

    var table = $('#records').DataTable({
        "info":             false,
        "processing":       true,
        "serverSide":       true,
        "ajax": {
            "url": "/{{project.id}}/datatable/parameter",
            "data": function ( d ) {
                d.main_file = selected_main_file;
                d.columns = columns;
            }
        },
        "columns":          columns.map(function (col) { return {'data':col};}),
        "order":            [[ 1, "desc" ]],
        "columnDefs":       columnDefs,
    });

    // // Apply the filter
    // $("#records tfoot input").on( 'keyup change', function () {
    //     table
    //         .column( $(this).parent().index()+':visible' )
    //         .search( this.value )
    //         .draw();
    // } );

});
{% endif %}
</script>
{% endblock %}
